#include "LPD8806.h"
#include "SPI.h"

// Simple test for 160 (5 meters) of LPD8806-based RGB LED strip
// Not compatible with Trinket/Gemma due to limited RAM

/*****************************************************************************/

// Number of RGB LEDs in strand:
#define N_LEDS       312 // Number of LEDs in the pixel strip

// Size of the square image
#define N_PIXELS      1000 // Number of pixels in the inputted image

// Images
const uint8_t laika[][3] PROGMEM = {{127,12,3},{127,11,3},{127,11,2},{127,11,1},{127,12,2},{127,11,0},{127,11,0},{127,12,0},{127,13,0},{127,14,0},{127,14,0},{127,16,0},{127,17,0},{127,18,1},{127,19,1},{127,19,1},{127,20,1},{127,22,2},{127,24,3},{127,25,2},{127,25,3},{127,26,2},{127,28,3},{127,30,5},{127,31,4},{127,32,5},{127,34,6},{127,36,6},{127,37,7},{127,39,7},{127,41,7},{127,42,7},{127,44,7},{127,46,9},{127,47,9},{127,49,9},{127,52,11},{127,53,11},{127,54,11},{127,56,12},{127,58,12},{127,60,13},{127,61,12},{127,63,13},{127,65,13},{127,66,14},{127,68,14},{127,69,14},{127,70,13},{127,72,14},{127,74,14},{127,75,13},{127,76,14},{126,77,13},{127,78,13},{126,79,14},{127,80,13},{127,82,13},{127,82,12},{127,83,12},{126,85,12},{126,86,12},{126,86,11},{126,88,11},{127,88,10},{127,88,10},{126,89,10},{126,90,9},{126,90,9},{126,90,9},{126,90,8},{125,91,8},{125,91,7},{125,91,6},{125,92,6},{125,92,6},{125,92,5},{125,93,5},{126,93,4},{125,94,4},{124,93,4},{124,93,4},{124,94,3},{124,94,3},{124,94,2},{124,94,2},{124,94,2},{123,94,2},{123,94,2},{123,94,1},{122,95,1},{122,95,1},{122,95,1},{122,95,1},{121,94,0},{121,95,0},{120,95,0},{121,94,0},{120,95,0},{120,95,0},{119,95,0},{119,96,0},{119,95,0},{119,95,0},{118,95,0},{117,96,0},{117,96,0},{117,96,0},{116,96,0},{115,96,0},{114,97,0},{114,97,0},{113,97,0},{113,97,0},{112,97,0},{112,98,0},{111,97,0},{110,98,0},{110,98,0},{109,98,0},{108,99,0},{107,99,0},{106,99,0},{106,99,0},{106,100,0},{104,100,0},{103,99,0},{103,100,0},{102,101,0},{101,101,0},{100,102,0},{99,102,0},{98,101,0},{96,102,0},{95,103,0},{95,103,0},{94,103,0},{92,103,0},{92,104,0},{90,104,0},{88,105,0},{88,105,0},{87,105,0},{86,106,0},{84,107,0},{83,106,0},{82,107,0},{80,107,0},{78,108,0},{78,108,0},{76,108,0},{74,108,1},{74,109,0},{72,110,1},{70,110,1},{68,110,0},{67,111,0},{67,112,1},{65,113,1},{64,113,1},{62,112,1},{60,113,1},{60,114,1},{58,113,2},{56,115,2},{55,115,2},{53,116,3},{52,116,2},{50,117,2},{49,117,3},{48,117,4},{47,118,4},{45,118,4},{43,119,4},{42,119,4},{41,119,4},{39,120,4},{39,120,5},{38,121,5},{36,121,5},{35,122,5},{34,122,5},{32,122,6},{30,122,5},{29,122,7},{29,122,7},{27,123,7},{26,123,7},{25,123,7},{24,124,8},{23,124,8},{23,124,9},{22,125,10},{21,124,9},{21,124,9},{19,124,9},{19,124,10},{18,125,10},{18,125,11},{17,125,11},{17,125,11},{15,125,12},{15,125,11},{15,124,11},{15,125,13},{15,126,13},{14,125,13},{15,125,14},{15,126,14},{15,124,15},{15,124,15},{15,124,16},{14,124,18},{14,124,18},{15,124,19},{15,123,21},{14,123,23},{14,123,23},{15,123,23},{15,123,24},{15,123,27},{16,122,27},{16,123,29},{16,123,30},{16,122,31},{16,122,32},{17,121,34},{17,122,36},{17,121,37},{17,121,38},{19,121,40},{18,121,41},{19,120,43},{19,120,45},{20,119,47},{20,120,49},{21,120,50},{20,119,52},{21,119,54},{21,118,56},{22,118,57},{22,118,60},{21,118,61},{22,118,62},{22,117,64},{22,117,66},{22,117,69},{22,116,69},{22,116,70},{22,116,72},{22,116,74},{22,115,76},{22,115,77},{21,115,78},{21,114,79},{21,114,80},{21,114,82},{21,114,82},{19,113,84},{20,113,86},{20,113,87},{19,112,88},{19,112,89},{19,113,89},{17,112,90},{17,112,91},{17,111,91},{16,111,92},{16,110,93},{15,110,93},{15,110,94},{15,109,94},{14,109,95},{14,108,95},{13,108,97},{13,107,96},{12,107,97},{12,107,97},{12,106,97},{11,106,97},{10,106,98},{10,105,98},{10,105,99},{10,105,100},{9,104,99},{8,103,98},{8,102,99},{8,102,99},{8,101,101},{8,101,100},{8,100,101},{7,99,100},{7,99,101},{6,99,100},{6,98,101},{6,98,102},{6,97,102},{5,96,101},{5,96,101},{5,95,102},{5,94,102},{5,93,102},{5,92,103},{5,91,102},{5,91,103},{4,90,103},{4,89,103},{4,88,104},{5,87,104},{4,86,104},{4,85,105},{4,84,104},{4,82,104},{4,81,105},{4,81,106},{3,80,106},{3,78,107},{4,77,106},{3,75,106},{3,74,107},{3,73,108},{3,72,107},{3,71,108},{3,70,108},{3,68,109},{3,67,109},{3,66,110},{3,65,110},{3,64,110},{3,62,111},{2,60,112},{2,59,111},{2,58,111},{3,56,112},{3,54,113},{2,53,112},{2,51,114},{2,50,114},{2,49,114},{2,47,115},{3,46,115},{3,44,115},{3,43,116},{3,42,117},{3,40,117},{3,38,117},{3,37,118},{3,35,118},{3,34,119},{3,33,119},{3,32,119},{3,29,119},{3,28,119},{3,27,120},{3,26,120},{4,24,121},{3,23,121},{3,22,122},{3,20,122},{3,19,123},{3,18,123},{3,18,124},{3,17,124},{3,15,124},{3,14,124},{2,13,124},{3,13,125},{3,11,125},{3,10,124},{3,9,125},{2,9,125},{2,8,125},{2,8,126},{2,8,126},{3,6,126},{1,6,126},{2,5,127},{1,4,126},{1,4,126},{2,4,127},{1,3,127},{1,3,127},{0,2,127},{0,2,127},{1,2,127},{1,2,127},{1,2,127},{1,1,127},{1,1,127},{1,2,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{1,1,127},{2,1,127},{2,1,127},{2,1,127},{2,1,127},{2,1,127},{2,1,127},{2,1,127},{2,1,127},{2,1,127},{3,0,127},{3,0,127},{4,1,127},{4,0,127},{4,0,127},{4,0,127},{4,0,127},{4,0,127},{4,1,127},{5,0,127},{5,0,127},{5,0,127},{6,0,127},{6,0,127},{6,0,127},{8,0,127},{8,0,127},{8,0,127},{8,0,127},{9,0,127},{9,0,127},{10,1,127},{11,1,127},{11,1,127},{12,0,127},{12,1,127},{13,1,127},{15,1,127},{15,2,127},{15,2,127},{17,2,127},{18,2,127},{18,3,127},{20,4,127},{21,4,127},{23,3,127},{24,4,127},{25,5,127},{26,6,127},{27,5,127},{28,7,127},{30,7,127},{32,8,127},{33,8,127},{35,9,127},{36,9,127},{37,10,127},{39,11,127},{40,11,127},{42,11,127},{44,12,127},{44,13,127},{45,12,127},{47,13,127},{49,14,127},{50,14,127},{51,14,127},{52,14,127},{55,14,127},{56,15,127},{56,15,127},{58,14,127},{59,15,127},{61,15,127},{61,16,127},{61,15,127},{63,15,127},{64,15,127},{65,15,127},{66,15,127},{67,15,127},{68,14,127},{68,14,127},{69,13,127},{69,13,127},{70,12,127},{70,12,127},{70,11,127},{70,11,127},{72,11,127},{71,10,127},{71,10,127},{72,10,127},{72,9,127},{72,9,127},{73,8,127},{72,8,127},{72,7,127},{72,7,127},{73,7,127},{73,6,127},{72,5,127},{73,5,127},{73,4,127},{73,4,127},{73,4,127},{73,4,127},{73,3,127},{72,3,127},{72,2,127},{72,2,127},{72,2,127},{72,2,127},{73,1,127},{72,1,127},{72,1,127},{73,1,127},{73,1,127},{72,0,127},{72,0,127},{72,0,127},{72,0,127},{72,0,127},{72,0,127},{72,0,127},{73,0,127},{72,0,127},{72,0,127},{73,0,127},{72,0,127},{72,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{73,0,127},{74,0,127},{74,0,127},{74,0,127},{75,0,127},{75,0,127},{75,0,127},{75,0,127},{75,0,127},{75,0,127},{75,0,127},{75,0,127},{76,0,127},{77,0,127},{77,0,127},{77,0,127},{77,0,127},{77,0,127},{77,0,127},{77,0,127},{78,0,127},{78,0,127},{78,0,127},{78,0,127},{78,0,127},{80,0,127},{80,0,127},{80,0,127},{80,0,127},{80,0,127},{82,0,127},{82,0,127},{83,0,127},{83,0,127},{83,0,127},{83,1,127},{84,0,127},{84,0,127},{85,1,127},{86,0,127},{86,0,127},{87,0,127},{88,1,127},{89,1,127},{89,1,127},{89,1,127},{90,1,127},{91,2,127},{91,2,127},{92,2,127},{93,3,127},{94,3,127},{95,3,127},{95,3,127},{96,3,127},{97,4,127},{98,4,127},{99,5,127},{100,5,127},{101,5,127},{101,5,127},{102,6,127},{102,5,127},{104,5,127},{105,6,127},{104,7,127},{106,7,127},{106,7,127},{107,6,127},{108,7,127},{109,7,127},{109,7,127},{110,7,127},{111,7,127},{111,8,127},{112,7,127},{113,8,127},{114,7,127},{114,7,127},{114,7,127},{114,7,127},{114,7,127},{115,7,127},{116,7,127},{116,6,127},{116,7,127},{116,6,127},{117,6,127},{117,5,127},{118,5,127},{118,5,127},{118,5,127},{118,4,127},{119,4,127},{118,3,127},{119,3,127},{119,3,127},{119,3,127},{120,2,127},{119,2,127},{119,2,127},{119,2,127},{119,1,127},{119,1,127},{120,2,127},{119,1,126},{120,1,126},{120,0,126},{120,0,126},{120,0,126},{120,0,126},{120,0,126},{120,0,126},{120,0,126},{120,0,126},{120,0,126},{120,0,125},{120,0,124},{120,0,124},{120,0,124},{120,0,124},{120,0,124},{120,0,123},{120,0,123},{120,0,122},{121,0,122},{120,0,122},{120,1,122},{121,0,122},{121,0,122},{121,0,121},{120,0,120},{120,0,119},{120,0,119},{120,0,118},{120,0,118},{121,0,117},{121,0,117},{121,0,117},{120,0,115},{120,0,114},{121,0,113},{121,0,113},{121,0,112},{121,0,111},{121,0,110},{120,0,108},{120,0,108},{121,0,107},{121,0,106},{122,0,105},{121,0,103},{121,0,102},{121,0,101},{121,0,100},{122,0,98},{122,0,96},{122,0,94},{122,0,93},{122,0,91},{122,0,90},{122,0,88},{123,0,86},{123,0,85},{122,0,83},{122,0,81},{123,0,79},{122,0,77},{123,0,75},{123,0,74},{123,0,71},{123,0,70},{123,0,67},{123,0,66},{124,0,64},{124,0,61},{124,0,59},{124,0,57},{124,0,55},{125,0,53},{124,0,50},{125,0,49},{124,0,46},{124,0,44},{125,0,42},{125,0,40},{125,0,37},{126,0,36},{125,0,33},{125,0,32},{125,0,29},{126,0,28},{126,0,26},{126,0,24},{126,1,22},{126,1,21},{126,1,19},{126,1,17},{126,0,16},{126,1,14},{127,1,13},{127,1,11},{126,1,10},{127,0,9},{127,1,8},{127,1,8},{127,0,6},{127,0,6},{127,0,5},{127,0,5},{127,0,4},{127,0,4},{127,1,3},{127,1,3},{127,1,3},{127,0,3},{127,0,3},{127,1,3},{127,1,3},{127,1,3},{127,1,5},{127,1,5},{127,2,6},{127,2,7},{127,2,8},{127,3,9},{127,3,10},{127,4,11},{127,5,13},{127,6,14},{127,6,15},{127,7,17},{127,8,18},{127,9,20},{127,10,21},{127,11,23},{126,12,25},{127,14,27},{126,15,28},{126,16,30},{126,18,32},{126,19,34},{126,20,36},{126,22,38},{126,24,41},{126,26,42},{127,28,44},{127,30,47},{127,32,49},{126,34,51},{127,36,54},{126,38,56},{126,40,58},{126,42,60},{126,44,62},{126,47,64},{126,49,66},{126,50,68},{126,53,70},{126,56,73},{127,58,74},{127,60,76},{126,63,78},{127,65,81},{126,67,82},{126,69,83},{127,72,85},{127,74,88},{127,75,89},{127,78,90},{127,80,93},{126,81,94},{126,83,96},{126,85,97},{126,86,98},{126,88,99},{127,91,101},{127,92,102},{127,94,104},{127,96,105},{127,97,106},{127,98,107},{127,100,108},{127,102,109},{127,104,110},{127,105,111},{127,106,112},{127,107,114},{126,107,114},{127,109,115},{127,111,116},{127,111,116},{127,112,117},{127,113,118},{127,114,118},{126,115,119},{127,115,119},{127,116,120},{127,117,120},{127,118,121},{127,118,121},{127,119,122},{127,119,122},{127,120,122},{127,120,123},{127,121,123},{127,121,123},{127,121,123},{127,121,123},{127,122,124},{127,122,124},{127,123,124},{126,123,124},{126,123,124},{126,123,124},{126,123,124},{126,123,124},{126,123,124},{126,124,124},{126,124,124},{126,124,125},{125,124,124},{125,124,125},{125,123,124},{124,123,124},{124,123,123},{124,123,123},{123,122,123},{123,122,123},{123,123,123},{122,122,122},{122,122,122},{122,122,122},{121,121,121},{120,120,120},{120,120,120},{120,120,120},{119,119,119},{119,119,119},{117,117,117},{116,116,116},{116,116,116},{116,116,116},{114,114,114},{113,113,113},{113,113,113},{112,112,112},{110,110,110},{110,110,110},{109,109,109},{107,107,107},{106,106,106},{105,105,105},{103,103,103},{101,101,101},{100,100,100},{98,98,98},{96,96,96},{95,95,95},{94,94,94},{92,92,92},{89,89,89},{87,87,87},{85,85,85},{83,83,83},{81,81,81},{79,79,79},{77,77,77},{75,75,75},{72,72,72},{70,70,70},{67,67,67},{64,64,64},{62,62,62},{60,60,60},{57,57,57},{54,54,54},{51,51,51},{50,50,50},{46,46,46},{44,44,44},{43,43,43},{39,39,39},{37,37,37},{34,34,34},{33,33,33},{30,30,30},{27,27,27},{26,26,26},{23,23,23},{22,22,22},{20,20,20},{17,17,17},{16,16,16},{15,15,15},{14,14,14},{12,12,12},{10,10,10},{9,9,9},{8,8,8},{7,7,7},{6,6,6},{5,5,5},{5,5,5},{4,4,4},{3,3,3},{2,2,2},{3,3,3},{2,2,2},{1,1,1},{0,0,0},{1,1,1},{1,1,1},{0,0,0},{1,1,1},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0},{0,0,0}};

// Chose 2 pins for output; can be any valid output pins:
int dataPin  = 2;
int clockPin = 3;

// First parameter is the number of LEDs in the strand.  The LED strips
// are 32 LEDs per meter but you can extend or cut the strip.  Next two
// parameters are SPI data and clock pins:
LPD8806 strip = LPD8806(N_LEDS, dataPin, clockPin);

// You can optionally use hardware SPI for faster writes, just leave out
// the data and clock pin parameters.  But this does limit use to very
// specific pins on the Arduino.  For "classic" Arduinos (Uno, Duemilanove,
// etc.), data = pin 11, clock = pin 13.  For Arduino Mega, data = pin 51,
// clock = pin 52.  For 32u4 Breakout Board+ and Teensy, data = pin B2,
// clock = pin B1.  For Leonardo, this can ONLY be done on the ICSP pins.
//LPD8806 strip = LPD8806(N_LEDS);

void setup() {
  Serial.begin(9600);
  // Start up the LED strip
  strip.begin();

  // Update the strip, to start they are all 'off'
  strip.show();
}

void displayPixels(uint8_t currentImage[][3], uint8_t nLoops, uint8_t wait);

void loop() {
  uint8_t nLoops = 30;
  uint8_t wait = 20;
  displayPixels(laika, nLoops, wait);
}

void displayPixels(uint8_t currentImage[][3], uint8_t nLoops, uint8_t wait) {
  for (uint8_t loopCount=0; loopCount < nLoops; loopCount++) {
    uint16_t startingLocation;
    uint16_t pixelOffset;

    for (startingLocation = 0; startingLocation < N_PIXELS; startingLocation++) {
      Serial.println(startingLocation);
      for (pixelOffset = 0; pixelOffset < N_LEDS; pixelOffset++) {
        strip.setPixelColor(pixelOffset, strip.Color(pgm_read_byte(&(currentImage[(startingLocation+pixelOffset) % N_PIXELS][0])),
                                                     pgm_read_byte(&(currentImage[(startingLocation+pixelOffset) % N_PIXELS][1])),
                                                     pgm_read_byte(&(currentImage[(startingLocation+pixelOffset) % N_PIXELS][2]))
                                                     ));
      }
      strip.show();
      delay(wait);
    }    
  }
}

